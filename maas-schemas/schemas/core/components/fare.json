{
  "$id": "http://maasglobal.com/core/components/fare.json",
  "description": "A fare/price as billed to the user in WMPs or in tokens",
  "type": "object",
  "definitions": {
    "tokenId": {
      "type": "string",
      "pattern": "^[a-z]+(-[a-z]+)*-[a-z0-9_]+$"
    },
    "fareTypeCHARGE": { "const": "charge" },
    "fareTypeREFUND": { "const": "refund" },
    "fareType": {
      "oneOf": [
        { "$ref": "#/definitions/fareTypeCHARGE" },
        { "$ref": "#/definitions/fareTypeREFUND" }
      ]
    },
    "wmpAmount": {
      "description": "An amount of in-app credits",
      "type": "integer",
      "minimum": 0,
      "multipleOf": 1,
      "examples": [1234]
    },
    "tokenAmount": {
      "description": "An amount of in-app tokens",
      "type": "integer",
      "minimum": 0,
      "examples": [1]
    },
    "wmpFields": {
      "description": "collection of in-app credit fields shared by fare and balance",
      "type": "object",
      "properties": {
        "currency": { "$ref": "http://maasglobal.com/core/components/units.json#/definitions/metaCurrencyWMP" },
        "amount": { "$ref": "#/definitions/wmpAmount" },
        "originalAmount": {
          "$ref": "#/definitions/wmpAmount"
        },
        "productionAmount": {
          "$ref": "#/definitions/wmpAmount"
        }
      }
    },
    "tokenFields": {
      "description": "collection of token fields shared by fare and balance",
      "type": "object",
      "properties": {
        "currency": { "$ref": "http://maasglobal.com/core/components/units.json#/definitions/metaCurrencyTOKEN" },
        "tokenId": {
          "$ref": "#/definitions/tokenId"
        },
        "amount": { "$ref": "#/definitions/tokenAmount" },
        "originalAmount": {
          "$ref": "#/definitions/tokenAmount"
        },
        "productionAmount": {
          "$ref": "#/definitions/tokenAmount"
        }
      },
      "required": ["tokenId"]
    },
    "abstractFare": {
      "type": "object",
      "properties": {
        "type": {
          "$ref": "#/definitions/fareType"
        }
      },
      "required": ["type", "currency", "amount", "originalAmount", "productionAmount"],
      "additionalProperties": false
    },
    "wmpFare": {
      "description": "The cost of a booking in in-app credits",
      "allOf": [
        { "$ref": "#/definitions/abstractFare" },
        { "$ref": "#/definitions/wmpFields" }
      ],
      "examples": [
        {
          "currency": "WMP",
          "amount": 1234,
          "type": "charge"
        }
      ]
    },
    "tokenFare": {
      "description": "The cost of a booking in in-app tokens",
      "allOf": [
        { "$ref": "#/definitions/abstractFare" },
        { "$ref": "#/definitions/tokenFields" }
      ],
      "examples": [
        {
          "currency": "TOKEN",
          "tokenId": "cx-test-token_v2",
          "amount": 1,
          "type": "charge"
        }
      ]
    },
    "abstractBalance": {
      "type": "object",
      "properties": {
        "tokenId": { "$comment": "optional property" }
      },
      "required": ["currency", "amount"],
      "additionalProperties": false
    },
    "wmpBalance": {
      "description": "The cost of a booking in in-app credits",
      "allOf": [
        { "$ref": "#/definitions/abstractBalance" },
        { "$ref": "#/definitions/wmpFields" }
      ],
      "examples": [
        {
          "currency": "WMP",
          "amount": 1234
        }
      ]
    },
    "tokenBalance": {
      "description": "The cost of a booking in in-app tokens",
      "allOf": [
        { "$ref": "#/definitions/abstractBalance" },
        { "$ref": "#/definitions/tokenFields" }
      ],
      "examples": [
        {
          "currency": "TOKEN",
          "tokenId": "cx-test-token_v2",
          "amount": 1
        }
      ]
    },
    "fare": {
      "oneOf": [
        { "$ref": "#/definitions/wmpFare" },
        { "$ref": "#/definitions/tokenFare" }
      ]
    },
    "faresArray": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/fare"
      }
    },
    "balance": {
      "oneOf": [
        { "$ref": "#/definitions/wmpBalance" },
        { "$ref": "#/definitions/tokenBalance" }
      ]
    },
    "balancesArray": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/balance"
      }
    },
    "balancesObject": {
      "description": "A summary of in-app credit and tokens",
      "type": "object",
      "properties": {
        "WMP": { "$ref": "#/definitions/wmpBalance" }
      },
      "patternProperties": {
        "^[a-z]+(-[a-z]+)*-[a-z0-9_]+$": { "$ref": "#/definitions/tokenBalance" }
      },
      "required": ["WMP"],
      "additionalProperties": false,
      "examples": [
        {
          "WMP": {
            "currency": "WMP",
            "amount": 1234,
            "type": "charge"
          },
          "cx-test-token_v2": {
            "currency": "TOKEN",
            "tokenId": "cx-test-token_v2",
            "amount": 1,
            "type": "charge"
          }
        }
      ]
    }
  }
}
